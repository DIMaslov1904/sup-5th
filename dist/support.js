(function(){function u(e,t,o){if(document.getElementById(e))return console.warn(`Элемент с идентификатором "${e}" уже существует.`),document.getElementById(e);function c(n){n.close(),n.removeEventListener("click",r),o&&o(n)}function r({currentTarget:n,target:i}){(i===n||i.classList.contains("modal__close"))&&c(n)}function y(n){t&&t(n),n.showModal(),n.addEventListener("click",r),n.closeModal=()=>{n.removeEventListener("click",r),c(n)}}const d=document.createElement("button");d.classList.add("modal__close");const s=document.createElement("div");s.classList.add("modal__wrapper"),s.append(d);const a=document.createElement("dialog");return a.id=e,a.classList.add("modal"),a.append(s),document.body.append(a),a.openModal=()=>y(a),a}function l(e,t,o){o.style.border=e<t?"1px solid red":""}function m(e){if(!e.name.includes("start"))return;const t=new Date(e.value),o=e.closest("tr").querySelector('input[name*="time_end"]');if(!o.value)return;const c=new Date(o.value);l(c,t,o)}function f(e){if(!e.name.includes("end"))return;const t=new Date(e.value),o=new Date(e.closest("tr").querySelector('input[name*="time_start"]').value);l(t,o,e)}function p(e){e.addEventListener("focus",()=>{e.type="datetime-local",e.step=1}),e.addEventListener("blur",()=>{e.type="text",e.value=e.value.replace("T"," "),f(e),m(e)})}function v(e){const t=document.createElement("iframe","modal-iframe");return t.classList.add("iframe"),t.src="https://support.5th.ru/published/sta/work_log_edit.php?request_id="+e,t.onload=()=>{t.contentWindow.document.querySelectorAll('input[name*="time"]').forEach(p)},t}function h(e){const t=document.createElement("button");return t.className="btn-edit",t.innerHTML=`
    <svg xmlns="https://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
  <path d="M18.5 2.5a2.1 2.1 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
</svg>`,t.addEventListener("click",e),t}function w(){const t=window.location.hash.split("/");return t[t.length-1]}const E=u("iframe-modal",e=>{const t=v(w());e.children[0].append(t)},e=>{e.querySelector("iframe").remove(),document.getElementById("body-frame")?window.frames["body-frame"].contentWindow.location.reload():location.reload()});document.body.append(h(E.openModal))})();
