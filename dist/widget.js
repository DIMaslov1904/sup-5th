const k={UMI:"admin/content/sitetree/",EzPro:"ezpro/",Bitrix:"bitrix/admin/#authorize",ABO:"login.php",MODX:"manager/",AdminLTE:"admin/",Joomla:"administrator/"},y=(t,n)=>{switch(n){case"Нет":case"":return"#";case"Своя":case"WordPress":return`https://${t}`;case"Tilda":return"https://tilda.ru/login/";default:return`/${k[n]}`}},h=(t,n={})=>{if(!t)return 0;let r=Math.trunc(t);return n.min!==void 0&&(r=Math.max(r,n.min)),n.max!==void 0&&(r=Math.min(r,n.max)),r};let a=null,e=null,s=null;const l="projectsState",v=t=>{let n=t==="Своя"?"cms":t==="Нет"?"hosting":t.toLowerCase();return chrome.runtime.getURL(`/assets/icons/${n}.svg`)},g=async()=>{try{const t=await chrome.storage.local.get([l]);return t[l]!==void 0?JSON.parse(t[l]):null}catch(t){return console.error("Ошибка при получении из хранилища:",t),null}},f=async t=>{try{await chrome.storage.local.set({[l]:JSON.stringify(t)})}catch(n){console.error("Ошибка при сохранении в хранилище:",n)}},x=async()=>{var n;if(a=await g(),!a)return;let t;e!=null&&e.widgetPosition&&(e.widgetPosition.x||(n=e.widgetPosition)!=null&&n.y)&&(t=e.widgetPosition),a.projects=a.projects.map(r=>r.url===(e==null?void 0:e.url)?{...r,widgetPosition:t}:r),await f(a)},C=async()=>{if(a=await g(),!a)return;const t=new URL(window.location.href).hostname;e=a.projects.find(n=>n.url?n.subdomain?t.includes(n.url):t===n.url:!1)||null,e&&M()},M=async()=>{const t=document.createElement("link");t.href=chrome.runtime.getURL("widget.css"),t.rel="stylesheet",document.head.appendChild(t),s=document.createElement("div"),s.className="sup-5th-widget no_anim";const n=document.createElement("button");if(n.className="sup-5th-btn sup-5th-menu",n.style=`background-image: url(${v((e==null?void 0:e.cms)||"cms")})`,n.addEventListener("click",()=>s==null?void 0:s.classList.toggle("open")),s.appendChild(n),e&&e.urlAdmin){const o=document.createElement("a");o.className="sup-5th-btn",o.title="Перейти в админку",o.href=y(e.urlAdmin,e.cms),o.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="none">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M29.333 16C29.333 8.64 23.36 2.667 16 2.667S2.667 8.64 2.667 16 8.64 29.333 16 29.333"/>
      <g stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" opacity=".4">
        <path d="M10.666 4H12a37.899 37.899 0 0 0 0 24h-1.333M20 4a38.074 38.074 0 0 1 1.947 12"/>
        <path d="M4 21.333V20a38.074 38.074 0 0 0 12 1.947M4 12a37.899 37.899 0 0 1 24 0"/>
      </g>
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="1.5" d="m25.615 20.987-4.72 4.72c-.187.186-.36.533-.4.786l-.254 1.8c-.093.654.36 1.107 1.014 1.014l1.8-.254c.253-.04.613-.213.786-.4l4.72-4.72c.814-.813 1.2-1.76 0-2.96-1.186-1.186-2.133-.8-2.946.014Z"/>
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="1.5" d="M24.932 21.667c.4 1.44 1.52 2.56 2.96 2.96"/>
    </svg>
    `,s.appendChild(o)}if(e&&e.manual){const o=document.createElement("a");o.target="_blank",o.className="sup-5th-btn",o.title="Инструкция",o.href="https://"+e.manual,o.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="none">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M29.333 22.32V6.227c0-1.6-1.306-2.787-2.893-2.653h-.08c-2.8.24-7.053 1.666-9.427 3.16l-.226.146c-.387.24-1.027.24-1.414 0l-.333-.2C12.587 5.2 8.347 3.787 5.547 3.56c-1.587-.133-2.88 1.067-2.88 2.654V22.32c0 1.28 1.04 2.48 2.32 2.64l.386.054c2.894.386 7.36 1.853 9.92 3.253l.054.027c.36.2.933.2 1.28 0 2.56-1.414 7.04-2.894 9.946-3.28l.44-.054c1.28-.16 2.32-1.36 2.32-2.64Z"/>
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7.32v20m-5.667-16h-3m4 4h-4" opacity=".4"/>
    </svg>
    `,s.appendChild(o)}if(e&&e.addDocument){const o=document.createElement("a");o.target="_blank",o.className="sup-5th-btn",o.title="Доп документ",o.href="https://"+e.addDocument,o.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="none">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="1.5" d="M28 9.333v13.334c0 4-2 6.666-6.667 6.666H10.667C6 29.333 4 26.667 4 22.667V9.333c0-4 2-6.666 6.667-6.666h10.666C26 2.667 28 5.333 28 9.333Z"/>
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="1.5" d="M19.333 6v2.667c0 1.466 1.2 2.666 2.667 2.666h2.667m-14 6H16m-5.333 5.334h10.666" opacity=".4"/>
    </svg>
    `,s.appendChild(o)}const r=(e==null?void 0:e.widgetPosition)||{x:0,y:0};s.style.setProperty("--x",`${r.x}dvw`),s.style.setProperty("--y",`${r.y}dvh`),s.style.setProperty("flex-direction",`${r.x>-50?"row-reverse":"row"}`),b(s),document.body.appendChild(s),s.style.setProperty("--width-full",`${s.childElementCount*68}px`)},b=t=>{let n=!1,r=!1,o=0,d=0,c=0,u=0;const m=()=>{const i=window.getComputedStyle(t);return{x:parseInt(i.getPropertyValue("--x")),y:parseInt(i.getPropertyValue("--y"))}};t.addEventListener("mousedown",i=>{r=!0,o=i.pageX,d=i.pageY}),document.body.addEventListener("mouseup",async()=>{n=!1,t.classList.remove("dragging"),e&&(e.widgetPosition=m(),await x())}),document.body.addEventListener("mousemove",i=>{if(r&&(Math.abs(o-i.pageX)>2||Math.abs(d-i.pageY)>2)){r=!1,n=!0,t.classList.add("dragging");const{x:p,y:w}=m();c=i.pageX-p/100*window.innerWidth,u=i.pageY-w/100*window.innerHeight}n&&(t.style.setProperty("--x",`${h((c-i.pageX)*-100/window.innerWidth,{min:-99,max:0})}dvw`),t.style.setProperty("--y",`${h((u-i.pageY)*-100/window.innerHeight,{min:-99,max:0})}dvh`))})};C();
