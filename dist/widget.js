const y={UMI:"admin/content/sitetree/",EzPro:"ezpro/",Bitrix:"bitrix/admin/#authorize",ABO:"login.php",MODX:"manager/",AdminLTE:"admin/",Joomla:"administrator/"},v=(t,e)=>{switch(e){case"Нет":case"":return"#";case"Своя":case"WordPress":return`https://${t}`;case"Tilda":return"https://tilda.ru/login/";default:return`/${y[e]}`}},p=(t,e={})=>{if(!t)return 0;let s=Math.trunc(t);return e.min!==void 0&&(s=Math.max(s,e.min)),e.max!==void 0&&(s=Math.min(s,e.max)),s};let a=null,r=null,n=null;const d="projectsState",k=t=>{let e=t==="Своя"?"cms":t==="Нет"?"hosting":t.toLowerCase();return chrome.runtime.getURL(`/assets/icons/${e}.svg`)},g=async()=>{try{const t=await chrome.storage.local.get([d]);return t[d]!==void 0?JSON.parse(t[d]):null}catch(t){return console.error("Ошибка при получении из хранилища:",t),null}},f=async t=>{try{await chrome.storage.local.set({[d]:JSON.stringify(t)})}catch(e){console.error("Ошибка при сохранении в хранилище:",e)}},x=async()=>{var e;if(a=await g(),!a)return;let t;r!=null&&r.widgetPosition&&(r.widgetPosition.x||(e=r.widgetPosition)!=null&&e.y)&&(t=r.widgetPosition),a.projects=a.projects.map(s=>s.url===(r==null?void 0:r.url)?{...s,widgetPosition:t}:s),await f(a)},C=async()=>{if(a=await g(),!a)return;const t=new URL(window.location.href).hostname;r=a.projects.find(e=>e.url?e.subdomain?t.includes(e.url):t===e.url:!1)||null,r&&M()},M=async()=>{const t=document.createElement("link");t.href=chrome.runtime.getURL("widget.css"),t.rel="stylesheet",document.head.appendChild(t),n=document.createElement("div"),n.className="sup-5th-widget";const e=document.createElement("button");if(e.className="sup-5th-btn sup-5th-menu",e.title="Нажмите для открытия / Зажмите для переноса",e.style=`background-image: url(${k((r==null?void 0:r.cms)||"cms")})`,e.addEventListener("click",()=>{if(!n)return;window.getComputedStyle(n).getPropertyValue("flex-direction")==="row"&&!(n!=null&&n.classList.contains("open"))?n.style.setProperty("--translate",`translate(min(max(calc(var(--x) + ${(n.childElementCount-1)*68}px), calc((100dvw - var(--width) - var(--offset)) * -1)), 0dvw), min(max(var(--y), calc((100dvh - var(--height) - var(--offset)) * -1)), 0dvh))`):n.style.setProperty("--translate","translate(min(max(var(--x), calc((100dvw - var(--width) - var(--offset)) * -1)), 0dvw), min(max(var(--y), calc((100dvh - var(--height) - var(--offset)) * -1)), 0dvh))"),n==null||n.classList.toggle("open")}),n.appendChild(e),r&&r.urlAdmin){const o=document.createElement("a");o.className="sup-5th-btn",o.title="Перейти в админку",o.href=v(r.urlAdmin,r.cms),o.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" width="0" viewBox="0 0 32 32" fill="none">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M29.333 16C29.333 8.64 23.36 2.667 16 2.667S2.667 8.64 2.667 16 8.64 29.333 16 29.333"/>
      <g stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" opacity=".4">
        <path d="M10.666 4H12a37.899 37.899 0 0 0 0 24h-1.333M20 4a38.074 38.074 0 0 1 1.947 12"/>
        <path d="M4 21.333V20a38.074 38.074 0 0 0 12 1.947M4 12a37.899 37.899 0 0 1 24 0"/>
      </g>
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="1.5" d="m25.615 20.987-4.72 4.72c-.187.186-.36.533-.4.786l-.254 1.8c-.093.654.36 1.107 1.014 1.014l1.8-.254c.253-.04.613-.213.786-.4l4.72-4.72c.814-.813 1.2-1.76 0-2.96-1.186-1.186-2.133-.8-2.946.014Z"/>
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="1.5" d="M24.932 21.667c.4 1.44 1.52 2.56 2.96 2.96"/>
    </svg>
    `,n.appendChild(o)}if(r&&r.manual){const o=document.createElement("a");o.target="_blank",o.className="sup-5th-btn",o.title="Инструкция",o.href="https://"+r.manual,o.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" width="0" viewBox="0 0 32 32" fill="none">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M29.333 22.32V6.227c0-1.6-1.306-2.787-2.893-2.653h-.08c-2.8.24-7.053 1.666-9.427 3.16l-.226.146c-.387.24-1.027.24-1.414 0l-.333-.2C12.587 5.2 8.347 3.787 5.547 3.56c-1.587-.133-2.88 1.067-2.88 2.654V22.32c0 1.28 1.04 2.48 2.32 2.64l.386.054c2.894.386 7.36 1.853 9.92 3.253l.054.027c.36.2.933.2 1.28 0 2.56-1.414 7.04-2.894 9.946-3.28l.44-.054c1.28-.16 2.32-1.36 2.32-2.64Z"/>
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7.32v20m-5.667-16h-3m4 4h-4" opacity=".4"/>
    </svg>
    `,n.appendChild(o)}if(r&&r.addDocument){const o=document.createElement("a");o.target="_blank",o.className="sup-5th-btn",o.title="Доп документ",o.href="https://"+r.addDocument,o.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" width="0" viewBox="0 0 32 32" fill="none">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="1.5" d="M28 9.333v13.334c0 4-2 6.666-6.667 6.666H10.667C6 29.333 4 26.667 4 22.667V9.333c0-4 2-6.666 6.667-6.666h10.666C26 2.667 28 5.333 28 9.333Z"/>
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="1.5" d="M19.333 6v2.667c0 1.466 1.2 2.666 2.667 2.666h2.667m-14 6H16m-5.333 5.334h10.666" opacity=".4"/>
    </svg>
    `,n.appendChild(o)}const s=(r==null?void 0:r.widgetPosition)||{x:0,y:0};n.style.setProperty("--x",`${s.x}dvw`),n.style.setProperty("--y",`${s.y}dvh`),n.style.setProperty("flex-direction",`${s.x>-50?"row-reverse":"row"}`),b(n),document.body.appendChild(n),n.style.setProperty("--width-full",`${n.childElementCount*68}px`)},b=t=>{let e=!1,s=!1,o=0,c=0,u=0,h=0;const m=()=>{const i=window.getComputedStyle(t);return{x:parseInt(i.getPropertyValue("--x")),y:parseInt(i.getPropertyValue("--y"))}};t.addEventListener("mousedown",i=>{s=!0,o=i.pageX,c=i.pageY;const{x:l,y:w}=m();u=i.pageX-l/100*window.innerWidth,h=i.pageY-w/100*window.innerHeight}),document.body.addEventListener("mouseup",async()=>{e=!1,s=!1,t.classList.remove("dragging"),r&&(r.widgetPosition=m(),await x())}),document.body.addEventListener("mousemove",i=>{if(s&&(Math.abs(o-i.pageX)>2||Math.abs(c-i.pageY)>2)&&(s=!1,e=!0,t.classList.add("dragging")),!e)return;const l=p((u-i.pageX)*-100/window.innerWidth,{min:-99,max:0});t.style.setProperty("--x",`${l}dvw`),t.style.setProperty("--y",`${p((h-i.pageY)*-100/window.innerHeight,{min:-99,max:0})}dvh`),t.style.setProperty("flex-direction",`${l>-50?"row-reverse":"row"}`)})};C();
